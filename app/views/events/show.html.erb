<div class="content-container">
  <h1>Event title <%= @event.emoji %></h1>
  <br>

  <%= link_to "Event conversation", @event_path, method: :get %>
  <p><i class="fas fa-paper-plane"></i></p>
  <br>
  <!-- To do later: automatic with the name of the emoji but editable -->
  <!-- <h5>Toggle button to go from Event Details to Event Messages</h5> -->
  <h5>Proposed by <%= @event.user.first_name %></h5>
  <%= cl_image_tag @event.user.avatar.key, class: "avatar-profile" %>
  <br>
  <br>

  <h5>Where</h5>
  <p><%= @event.address %></p>
  <br>

  <h5>When</h5>
  <p><%= @event.date_time %></p>
  <br>

  <p><%= "Feel free to join with an extra friend!" if @event.open == true %></p>
  <br>

  <h5>Description</h5>
  <p><%= @event.description %></p>
  <br>

  <%#=  si le mec qui arrive sur la show est host
  j'affiche event parti %>

  <h5>🙋 Friends participating</h5>

  <% @event.event_users.each do |event_user| %>
      <% if event_user.status == "confirmed" %>
        <p>
          <%= cl_image_tag event_user.user.avatar.key, class: "avatar-profile" %>
          <%= event_user.user.first_name %>
        </p>
      <% end %>
    <% end %>

  <% if @user_is_host %>

    <h5>🤷‍♂️ Propositions pending</h5>

    <% @event.event_users.each do |event_user| %>
      <% if event_user.status == "pending" %>
        <p>
          <%= cl_image_tag event_user.user.avatar.key, class: "avatar-profile" %>
          <%= event_user.user.first_name %>
        </p>
      <% end %>
    <% end %>

    <h5>🙅‍♂️ Friends not available</h5>

    <% @event.event_users.each do |event_user| %>
      <% if event_user.status == "declined" %>
        <p>
          <%= cl_image_tag event_user.user.avatar.key, class: "avatar-profile" %>
          <%= event_user.user.first_name %>
        </p>
      <% end %>
    <% end %>

    <!-- <h5>Recap all guests</h5>

    <%# @event.guests.each do |guest|%>
      <p> 🙍‍♂️ <%#= guest.first_name %></p>
      <%#= cl_image_tag guest.avatar.key, class: "avatar-profile" %>
    <%# end %> -->

    <br>
    <%= link_to "Edit plan", event_path, method: :get %>
    <br>

    <% if policy(@event).edit_friends? %>
      <%= link_to "Manage invitations", edit_friends_event_path, method: :get, class: "" %>
    <% end %>

    <br>
    <%= link_to "Copy link", event_path, method: :get %>

    <br>
    <% if policy(@event).destroy? %>
    <%= link_to "Delete plan",
                event_path(@event),
                class: "",
                method: :delete,
                data: { confirm: "Are you sure?" } %>
    <% end %>

  <% else  %>

    <% if @event.event_users.find_by(user: current_user).status == "confirmed" %>

      <%= link_to "Change answer", @event_path, method: :get %>

      <% if @event.event_users.find_by(user: current_user).role == "partner" %>
        <%= link_to "Invite a friend", @event_path, method: :get %>
      <% else %>
      <% end %>

    <% elsif @event.event_users.find_by(user: current_user).status == "pending" %>

      <%= link_to "Join", @event_path, method: :get %>
      <%= link_to "Declined", @event_path, method: :get %>

    <% else %>
      <%# le statut de l'event doit passer en "declined" et pas en "past"  %>

    <% end %>
  <% end  %>

  <br>
  <br>
  <br>
  <br>

  </div>
