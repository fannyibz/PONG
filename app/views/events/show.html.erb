<div class="content-container">

  <div class="pages-title">
    <div class="d-flex align-items-center justify-content-center">
      <div class="back-button-title">
        <%= link_to events_path do %>
          <i class="fas fa-chevron-left text-white"></i>
        <% end %>
      </div>

      <div class="box-title">
        <h1 id="event-show-title">
          <%= "#{@event.emoji} Let's #{Event::EMOJI.find { |k, v| v == @event.emoji }.first }!" %>
        </h1>
      </div>

      <div class="empty-box-title"></div>
    </div>

    <p>Seems awesome, have fun guys.</p>
  </div>

  <%= render "events/info_event_show_box", event: @event %>

  <div class="event-show-timer">
    <div>
      <% if Time.now < @event.date_time %>
        <div class="timer">
          <%= @event.time_left %>
        </div>
        <h6>Before the beginning of the event</h6>
      <% else %>
        <h1>
          <%= "It's #{@event.emoji} time! " %>
        </h1>
      <% end %>
    </div>
  </div>

  <div class="event-description-box">
    <p class="light-p">
      <%= "#{@event.description}"%>
    </p>
  </div>

  <%#=  si le mec qui arrive sur la show est host j'affiche event parti %>

  <%# DISPLAY FRIENDS FOR WHO THEY'RE JOINING THE EVENT %>

  <%# IF CURRENT_USER IS THE EVENT HOST %>
  <%# tip: '&' permet de refacto -> current_user && current_user.user_is_host?(@event) %>
  <% if current_user&.user_is_host?(@event) %>

    <%= render "events/event_users_list.html.erb", event_users: @event.event_users.order_by_status %>

    <div class="container-buttons-top-bottom">
      <%= link_to "✍️ Edit plan", edit_event_path(@event), class: "button-next mb-2" %>

      <% if policy(@event).destroy? %>
        <%= link_to "Manage invitations", edit_friends_event_path(@event), class: "button-next mb-2" if policy(@event).edit_friends? %>
        <%= link_to "Share event", root_path, class: "button-next btn-delete-grey mb-2" %>
        <%= link_to "Delete my plan", event_path(@event), method: :delete, data: { confirm: "Are you sure?" }, class: "button-next btn-delete-grey mb-2" %>
      <% end %>
    </div>

  <%# IF CURRENT_USER IS A PARTNER OR A VISITOR %>
  <% else  %>

    <% if current_user && @event.event_users.find_by(user: current_user).status == "confirmed" %>
      <%= link_to "Share link", event_path(@event), class: "button-next" if @event.event_users.find_by(user: current_user).role == "partner" %>
      <%= link_to "Invite a friend", event_path(@event), class: "button-next" if @event.event_users.find_by(user: current_user).role == "partner" %>
      <%= render "events/event_users_list.html.erb", event_users: @event.event_users.order_by_status %>
      <%= link_to "Decline event", events_path, method: :delete, data: { confirm: "Are you sure to delete your event?" }, class: "button-next mb-2" %>

    <% elsif current_user && @event.event_users.find_by(user: current_user).status == "pending" %>
      <%= render "events/event_users_list.html.erb", event_users: @event.event_users.order_by_status %>
      <%= link_to "Join 👊", confirm_event_user_path(@event.event_users.find_by(user: current_user)), class: "button-next btn-join mb-2" %>
      <%= link_to "Plouf 💦", decline_event_user_path(@event.event_users.find_by(user: current_user)), class: "button-next btn-plouf" %>
    <% end %>

  <%# else %>
      <%# le statut de l'event doit passer en "declined" et pas en "past"  %>
  <% end  %>
</div>

<%
=begin %>

<div class="content-container">

  <%= link_to chatroom_event_path(@event) do %>
    <h1 id="event-show-title">
      <%= "#{@event.emoji} Let's #{Event::EMOJI.find { |k, v| v == @event.emoji }.first } together!" %>
    </h1>
  <% end %>

  <%= render "events/info_event_show_box", event: @event %>
  <br>

  <div class="event-show-timer">
    <div id="timer">

        <%= @event.time_left %>

    </div>
    <h6>Before the beginning of the event</h6>
  </div>

  <div class="event-description-box">
    <p class="light-p">
      <%= "#{@event.description}"%>
    </p>
  </div>

  <%# DISPLAY FRIENDS FOR WHO THEY'RE JOINING THE EVENT %>

  <%# IF CURRENT_USER IS THE EVENT HOST %>
  <% if @user_is_host %>
    <div class="manage-event-buttons">
      <%= link_to "Share link", event_path, class: "button-medium" %>
      <%= link_to "Invite", edit_friends_event_path, class: "button-medium" if policy(@event).edit_friends? %>
    </div>

    <%= render "events/event_users_list.html.erb", event_users: @event.event_users.order_by_status %>

    <div class="container-buttons-top-bottom">
      <%= link_to "Edit plan", edit_event_path, class: "button-next mb-2" %>
      <% if policy(@event).destroy? %>
        <%= link_to "Delete my plan", event_path(@event), method: :delete, data: { confirm: "Are you sure?" }, class: "button-next" %>
      <% end %>
    </div>


  <%# IF CURRENT_USER IS A PARTNER OR A VISITOR %>
  <% else  %>

    <% if @event.event_users.find_by(user: current_user).confirmed? %>
      <div class="manage-event-buttons">
        <%# le statut du user doit passer en "declined" %>
        <%= link_to "Change answer", decline_event_user_path(@current_guest), class: "button-next mr-1" %>
        <%# le lien de l'event doit être copié dans le presse papier du current user pour qu'il puisse partager" %>
        <%= link_to "Invite a friend", @event_path, class: "button-next ml-1" if @current_guest.role == "partner" %>
      </div>

    <% elsif @current_guest.status == "pending" %>
      <%= render "events/event_users_list.html.erb", event_users: @event.event_users.order_by_status %>

      <%= link_to "Join 👊", confirm_event_user_path(@current_guest), class: "button-next btn-join mb-2" %>
      <%= link_to "Plouf 💦", decline_event_user_path(@current_guest), class: "button-next btn-plouf" %>

    <% else %>
      <%# le statut de l'event doit passer en "declined" et pas en "past"  %>
    <% end %>
  <% end  %>
</div>

<%
=end %>


